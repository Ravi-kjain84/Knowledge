import pandas as pd

# Step 1: Read the Excel file
file_path = 'path_to_your_excel_file.xlsx'
df = pd.read_excel(file_path)

# Example mapping DataFrame
data = {'Regulator': ['BAU', 'XYZ'], 'Name': ['John', 'Michael'], 'Age': [30, 35], 'City': ['London', 'New York']}
mapping_df = pd.DataFrame(data)

# Step 2: Define a function to replace placeholders dynamically
def replace_placeholders(row):
    # Create a dictionary of replacements based on the regulator
    replacements = mapping_df.loc[mapping_df['Regulator'] == row['Regulator']].to_dict('records')[0]
    if replacements:
        return row['SQL'].format(**replacements)
    return row['SQL']

# Step 3: Apply the function to the DataFrame
df['SQL'] = df.apply(replace_placeholders, axis=1)

# Step 4: Display the result
print(df)

----------------




import pandas as pd
from openpyxl import load_workbook

def copy_prod_data(df, file_path, sheet_name):
    try:
        # Step 1: Add "ApproachAndClass" column
        df['ApproachAndClass'] = df['ClassA'] + df['ClassB']

        # Step 2: Add "Modified_Customer_Group" column
        df['Modified_Customer_Group'] = df['Customer_Group'].apply(lambda x: 'PFS' if x == 'GPBB' else x)

        # Step 3: Open the XLSM file using openpyxl (keep VBA)
        book = load_workbook(file_path, keep_vba=True)

        # Step 4: Remove existing sheet if it exists
        if sheet_name in book.sheetnames:
            del book[sheet_name]

        # Step 5: Write data to new sheet using ExcelWriter
        with pd.ExcelWriter(file_path, engine='openpyxl', mode='a') as writer:
            writer._book = book
            df.to_excel(writer, sheet_name=sheet_name, index=False)

        # Step 6: Save the workbook explicitly (to retain VBA macros)
        book.save(file_path)

        print(f"Data written successfully to '{sheet_name}' in '{file_path}'.")

    except Exception as e:
        print(f"Error: {e}")

# Example Usage:
data = {
    'ID': [1, 2, 3],
    'Amount': [100, 200, 300],
    'Customer_Group': ['GPBB', 'ABC', 'XYZ'],
    'ClassA': ['Test1', 'Test2', 'Test3'],
    'ClassB': ['ClassA', 'ClassB', 'ClassC']
}

# Convert to DataFrame
df = pd.DataFrame(data)

# File path and worksheet name
file_path = 'output.xlsm'
sheet_name = 'Production Data'

# Call the function
copy_prod_data(df, file_path, sheet_name)
